<!DOCTYPE html>
<html>
<head>
<title>AI Study Companion</title>
<style>
body{
    margin:0;
    font-family:Arial;
    background:#0f172a;
    color:white;
    display:flex;
    flex-direction:column;
    height:100vh;
}
header{
    padding:15px;
    text-align:center;
    background:#020617;
    font-size:22px;
    font-weight:bold;
}
#files{ padding:10px; display:flex; gap:8px; flex-wrap:wrap; }
.fileChip{ background:#1e293b; padding:6px 10px; border-radius:12px; font-size:13px; }
#chat{
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:12px;
}
.message{ max-width:75%; padding:12px 16px; border-radius:16px; line-height:1.5; }
.user{ align-self:flex-end; background:#2563eb; }
.ai{ align-self:flex-start; background:#1e293b; }
#inputArea{
    display:flex;
    padding:15px;
    background:#020617;
    gap:10px;
}
#question{
    flex:1;
    padding:12px;
    border-radius:12px;
    border:none;
    background:#1e293b;
    color:white;
}
button{
    padding:12px 18px;
    border:none;
    border-radius:12px;
    background:#38bdf8;
    cursor:pointer;
}
</style>
</head>

<body>

<header>ðŸ“š AI Study Companion</header>
<div id="files"></div>
<div id="chat"></div>

<div id="inputArea">
    <label style="cursor:pointer;">
        ðŸ“Ž
        <input type="file" id="pdfFile" multiple hidden onchange="uploadPDF()">
    </label>
    <input id="question" placeholder="Ask from your notes..." 
           onkeydown="if(event.key==='Enter')askAI()">
    <button onclick="askAI()">Send</button>
</div>

<script>

function addMessage(text,type){
    const div=document.createElement("div");
    div.className="message "+type;
    div.innerHTML=text;
    document.getElementById("chat").appendChild(div);
    document.getElementById("chat").scrollTop=999999;
}

async function uploadPDF(){
    const files=document.getElementById("pdfFile").files;
    if(!files.length) return;

    const fd=new FormData();

    for(let file of files){
        fd.append("files",file);

        const chip=document.createElement("div");
        chip.className="fileChip";
        chip.innerText=file.name;
        document.getElementById("files").appendChild(chip);
    }

    const res=await fetch("/upload",{method:"POST",body:fd});
    const data=await res.json();

    addMessage(data.message,"ai");
}

async function askAI(){
    const q=document.getElementById("question").value;
    if(!q) return;

    addMessage(q,"user");
    document.getElementById("question").value="";

    const loading=document.createElement("div");
    loading.className="message ai";
    loading.innerText="Thinking...";
    document.getElementById("chat").appendChild(loading);

    try{
        const res=await fetch("/ask",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({question:q})
        });

        const data=await res.json();
        loading.remove();

        if(data.image){
            addMessage(`<img src="${data.image}" style="max-width:100%;border-radius:12px;">`,"ai");
        }else{
            addMessage(data.answer,"ai");
        }

    }catch(err){
        loading.innerText="Server error!";
    }
}

</script>

</body>
</html>